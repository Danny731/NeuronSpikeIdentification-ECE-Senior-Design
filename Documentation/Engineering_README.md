# Engineering Addendum: Neuron Spike Identification with Machine Learning

## Installation Instruction
Use git clone or download the repo to your desired path

Make sure you have Python version 3.8.1 or higher

Running terminal or powershell and direct to the folder path. Use the following command to download the package needed for this project:

```
pip install -r requirements.txt
```

The environment should be good to use. We strongly suggest building a virtual environment for this project to avoid accidents or conflicts when configuring the environment.


## Overview of Data Import and Preprocessing
The project accepts .mat, .abf, and .h5 files. However, the imported data type should be 1-D array so that it can be read and identified successfully. If your dataset is not in such a format, you may need extra work to transform it into 1-D arrays to make the following preprocessing and clustering process work. On the preprocessing part, we use the butter bandpass filters in python. One with frequency ranges from 300 to 3000 Hz to extract the spikes which are used in the following clustering process, and another has frequency ranges from 0.5 - 300 Hz to extract LFP signals. Though it is not used in the clustering, they are useful signals that are informative on other biological aspects. The frequencies of the bandpass filter are standard parameters that are commonly used in other researches on spikes. If you have special need on analyzing signals that are out of this range, feel free to change it. Otherwise, we don't recommend to do so. This also applies to the thresholding and fake spike deleting part. There can be situations that your signals collected are in a different unit scale. (The amplitude of our signals are in mV). You may need to figure out your parameters by trials or researches.

After processing and identification, all the spike detected are cut in a 2 ms window, and they are put in one window to see the comparison. There should be colorful lines in one window and each line represents one spike.


## Overview of PCA, K-means and K-TOPS clustering
The main code spikesortingVTJason.ipynb includes two methods of clustering: k-means and k-TOPS. K-means is a classical unsupervised machine learning technique that performs well on clustering. And k-TOPS is a clustering algorithm improved based on k-means. We refer to it, and the details of k-TOPS can be found in [this essay](https://www.nature.com/articles/s41598-018-35491-4). What we did is basically adding first derivative, i.e. the velocity of the original data, to provide more information and expect to get a better clustering result.

PCA is used in this project to visualize and evaluate clustering result. The scatter plot of the clustering are generated by using PCA to decrease the dimension of the data to 2. In such a way, the clusters can be visualized in a clear way. The standards we used to evaluate are L-ratio, isolation distances and silhoutte score. The K-TOPS we developed outperforms K-means on silhoutte score.

The number of clusters we used in our code is 3. The [example data](https://github.com/clairecropper/NeuronSpikeIdentification/blob/main/Dataset/10%20min%20recording1.mat) we tested perform well when the cluster number is 2 or 3, determined by the Elbow Plot. The coding of Elbow plot is not included in the code. It is possible to have different cluster numbers based on different needs and backgrounds. This is to-be-determined and does not have a ground truth. It can be a good idea for future development to develop a ML algorithm that determines the best number of clusters